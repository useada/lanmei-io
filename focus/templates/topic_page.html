{% include "header.html" %}

<div class="container-fluid">
    <div class="col-sm-1"></div>

    <!-- Center Column -->
    <div class="col-sm-7">
        <!-- Topic -->
        <div class="row">
            <article class="col-xs-12">
                <h2>{{ topic.content }}</h2>
            </article>
        </div>

        <!-- Article -->
        <hr>
        {% for article in article_list %}
            <div class="row">
                <div class="col-xs-1">

                    <div>
                        <div class="btn-group-vertical" role="group" aria-label="...">
                            <button type="button" class="btn btn-default">
                                <div class="row">
                                    <div class="col-sm-12"><span class="glyphicon glyphicon-triangle-top" aria-hidden="true"style="color: rgb(64, 212, 64);"></span></div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12"><span class="count">2418</span></div>
                                </div>
                            </button>
                            <button type="button" class="btn btn-default">
                                <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true" style="color: rgb(212, 106, 64);"></span>
                            </button>
                        </div>
                    </div>

                </div>

                <article class="col-xs-11">
                    <p>
                        <span class="h4">{{ article.author }}</span> <span>, {{ article.author.profile }}</span>
                    </p>
                    <div id="article-{{ article.id }}">
                        <div id="article-{{ article.id }}-show">
                            {{ article.content | safe }}
                        </div>
                        {% if user.id == article.author_id %}
                        <a class="pull-right" id="article-{{ article.id }}-edit-door" href="javascript:void(0);">
                                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> 修改
                        </a>
                        {% endif %}
                        <div id="article-{{ article.id }}-edit">
                            <textarea id="article-{{ article.id }}-editor" placeholder="" autofocus>
                            </textarea>

                            <div class="pull-right">
                                <button id="article-{{ article.id }}-edit-cancel" type="button" class="btn btn-default btn-lg">取消</button>
                                <button id="article-{{ article.id }}-edit-submit" type="button" class="btn btn-primary btn-lg">提交</button>
                            </div>

                        </div>

                    </div>
                    <p></p>

                    <div class="row">
                        <div class="col-xs-12">
                            <a id="article-{{ article.id }}-comment-door" href="javascript:void(0);"> <span class="glyphicon glyphicon-comment"></span> {{ article.comment_num }} 条评论(查看添加)</a>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            <div id="article-{{ article.id }}-comment">
{% include "comment.html" %}
                            </div>
                        </div>
                    </div>


                </article>


<script type="text/javascript">
    $('#article-{{ article.id }}-comment').hide();
    $('#article-{{ article.id }}-edit').hide();

    $('#article-{{ article.id }}-comment-door').click(
            function(){
                var door = $('#article-{{ article.id }}-comment-door');
                var node=$('#article-{{ article.id }}-comment');
                if (node.is(':visible'))
                {
                    node.hide();
                    door.html('<span class="glyphicon glyphicon-comment"></span> {{ article.comment_num }} 条评论(查看添加)');
                }
                else
                {
                    node.show();
                    door.html('<span class="glyphicon glyphicon-comment"></span> {{ article.comment_num }} 条评论(收起评论)');
                }
            });

    $('#article-{{ article.id }}-edit-door').click(
            function(){
                var door = $('#article-{{ article.id }}-edit-door');
                var show_node=$('#article-{{ article.id }}-show');
                var edit_node=$('#article-{{ article.id }}-edit');

                var cc = '<textarea id="article-{{ article.id }}-editor" placeholder="" autofocus></textarea>'
                        + '<div class="pull-right">'
                        + '<button id="article-{{ article.id }}-edit-cancel" type="button" class="btn btn-default btn-lg">取消</button>'
                        + '<button id="article-{{ article.id }}-edit-submit" type="button" class="btn btn-primary btn-lg">提交</button>'
                        + '</div>';

                edit_node.html(cc);

{#                var tt = $('#article-{{ article.id }}-editor');#}
                if (door.is(':visible'))
                {
                    door.hide();
                    show_node.hide();
                    edit_node.show();
                    var editor = new Simditor({
                        textarea: $('#article-{{ article.id }}-editor'),
                        //placeholder: show_node.text(),
                        //optional options
                    });
                    editor.setValue(show_node.html());

                    $('#article-{{ article.id }}-edit-cancel').click(
                            function() {
                                var door = $('#article-{{ article.id }}-edit-door');
                                var show_node=$('#article-{{ article.id }}-show');
                                var edit_node=$('#article-{{ article.id }}-edit');

                                door.show();
                                show_node.show();

                                edit_node.hide();
                            });

                    $('#article-{{ article.id }}-edit-submit').click(
                            function() {
                                var content = editor.getValue();

                                $.ajax({
                                    type:"POST",
                                    data: {content:content},
                                    url:  '/focus/edit_article/{{ topic.id }}/{{ article.id }}/',
                                    cache: false,
                                    dataType: "html",
                                    success: function(result, statues, xml){
                                        //alert(result);
                                        //$('#article-{{ article.id }}-comment').html(result);


                                        var door = $('#article-{{ article.id }}-edit-door');
                                        var show_node=$('#article-{{ article.id }}-show');
                                        var edit_node=$('#article-{{ article.id }}-edit');

                                        door.show();
                                        show_node.html(content);
                                        show_node.show();

                                        edit_node.hide();
                                    },
                                    error: function(){
                                        //alert("false");
                                        var door = $('#article-{{ article.id }}-edit-door');
                                        var show_node=$('#article-{{ article.id }}-show');
                                        var edit_node=$('#article-{{ article.id }}-edit');

                                        door.show();
                                        show_node.show();

                                        edit_node.hide();
                                    }
                                });
                                return false;
                            });
                }

            });


</script>


            </div>
            <hr>
        {% endfor %}

        <div class="row">
            <div class="col-xs-12" id="article-page">
            </div>
        </div>

        <script type="text/javascript">
            $('#article-page').twbsPagination({
                totalPages: {{ topic.total_article_page }},
                initiateStartPageClick: false,
                visiblePages: 5,
                startPage: {{ topic.article_page }},
                first: "首页",
                prev: "上页",
                next: "下页",
                last: "末页",
                paginationClass: "pagination center",
                href: '/focus/{{ topic.id }}/[[pageNumber]]',
                hrefVariable: '[[pageNumber]]',
            });
        </script>

        <!-- article submit -->
        <div class="row">
            <div class="col-xs-12">
                {% if request.user.is_authenticated %}
                    <span class="glyphicon glyphicon-user"></span> {{ user }}, 在这里, 写下您的故事吧
                {% else %}
                    <span class="glyphicon glyphicon-user"></span> 路人甲, 在这里, 写下您的故事吧
                {% endif %}
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <form action="/focus/add_article/{{ topic.id }}/" method="post">
                    {% csrf_token %}
                    {{ article_form.as_p }}
                    <div class="pull-right">
                        <input class="btn btn-primary" type="submit" value="发表" />
                    </div>
                </form>
            </div>
        </div>

        {% load staticfiles %}
        <link rel="stylesheet" type="text/css" href="{% static "simditor-2.3.6/styles/simditor.css" %}" />
        <script type="text/javascript" src="{% static "simditor-2.3.6/scripts/jquery.min.js" %}"></script>
        <script type="text/javascript" src="{% static "simditor-2.3.6/scripts/module.js" %}"></script>
        <script type="text/javascript" src="{% static "simditor-2.3.6/scripts/hotkeys.js" %}"></script>
        {#<script type="text/javascript" src="{% static "simditor-2.3.6/scripts/uploader.js" %}"></script>#}
        <script type="text/javascript" src="{% static "simditor-2.3.6/scripts/simditor.js" %}"></script>


        {#<textarea id="editor" placeholder="Balabala" autofocus></textarea>#}
        <script type="text/javascript">
            var editor = new Simditor({
                textarea: $('#editor')
                //optional options
            });
        </script>

    </div><!--/Center Column-->


    <!-- Right Column -->
{% include "righter.html" %}


    <div class="col-sm-1"></div>
</div><!--/container-fluid-->


{#<div id="epiceditor"></div>#}
{#{% load staticfiles %}#}
{#<script src="{% static "epiceditor/js/epiceditor.min.js" %}"></script>#}
{#<script language="javascript">#}
{#    var editor = new EpicEditor({basePath: '{% static "epiceditor" %}'}).load();#}
{#</script>#}



{% include "footer.html" %}